<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>결과 페이지 - 막대 그래프 오버레이</title>
    <style>
        /* ------------------------------------------- */
        /* 1. 기본 설정 및 뷰포트 고정 */
        /* ------------------------------------------- */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; 
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            box-sizing: border-box;
            background-color: #ffffff; 
            overflow: hidden; 
        }

        /* ------------------------------------------- */
        /* 2. 메인 컨테이너 (모바일 뷰포트 역할) */
        /* ------------------------------------------- */
        #result-container {
            width: 100%;
            max-width: 375px; /* 모바일 기기 너비 제한 유지 */
            height: 100%;
            position: relative; /* 절대 위치 요소의 기준점 */
            background-color: #ffffff; 
            overflow-y: auto; /* 스크롤 활성화 */
            -webkit-overflow-scrolling: touch;
            padding-bottom: 50px; /* 하단 스크롤 여유 공간 */
        }
        
        #result-container::-webkit-scrollbar { display: none; }
        #result-container { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ------------------------------------------- */
        /* 3. 결과 이미지 및 배경 */
        /* ------------------------------------------- */
        .result-image {
            width: 100%;
            height: auto;
            display: block;
            margin-top: 0; 
        }

        /* ------------------------------------------- */
        /* 4. 통계 섹션 (막대 그래프 영역) */
        /* ------------------------------------------- */
        .stat-section {
            position: absolute;
            top: 935px; /* ⭐ 이 값을 조정하여 그래프 위치를 맞춰주세요! */
            left: 68.5%;
            transform: translateX(-50%);
            width: 80%; /* 컨테이너 너비 조정 */
            max-width: 300px; 
            padding-top: 50px; /* SVG 이미지 영역 아래로 조정 */
        }

        .stat-item {
            display: flex;
            align-items: center;
            margin-bottom: 80px; /* 항목 사이 간격 100px 유지 */
        }
        
        .bar-container {
            /* flex-grow: 1; 속성을 제거하여 유연성을 없앱니다. */
            width: 176px; /* 회색 배경 막대의 길이를 176px로 고정 */
            flex-shrink: 0; /* 너비가 좁아져도 176px를 유지하도록 설정 */
            height: 5px; /* ✨ CSS 수정: 막대 굵기(높이)를 5px로 변경 */
            background-color: #e9ecef; /* 배경 막대 (회색) 색상 */
            border-radius: 3px; /* 굵기에 맞춰 radius 조정 */
            overflow: hidden;
            margin-right: 10px;
        }

        .bar {
            height: 100%;
            width: 0%; /* JS로 업데이트될 예정. 초기값 0% */
            transition: width 0.8s ease-out; /* 부드러운 애니메이션 */
            border-radius: 3px; /* 굵기에 맞춰 radius 조정 */
        }

        /* 막대 색상 정의 */
        .yellow-bar { background-color: #FFD700; } 
        .purple-bar { background-color: #8A2BE2; } 
        .pink-bar { background-color: #FF69B4; } 
        .green-bar { background-color: #3CB371; } 
        

        .score-info {
            width: 40px; /* 퍼센트 텍스트 영역 너비 고정 */
            text-align: right;
            font-size: 14px;
            font-weight: bold;
            color: #161317;
        }
        
    </style>
</head>
<body>
    <div id="result-container">
        
        <img src="Image/결과1_디지털.svg" alt="디지털 과부하 결과 이미지" class="result-image">
        
        <div class="stat-section">
            
            <div class="stat-item">
                <div class="bar-container">
                    <div class="bar yellow-bar result-bar bar-1" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-1">0%</span>
            </div>
            
            <div class="stat-item">
                <div class="bar-container">
                    <div class="bar purple-bar result-bar bar-2" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-2">0%</span>
            </div>
            
            <div class="stat-item">
                <div class="bar-container">
                    <div class="bar pink-bar result-bar bar-3" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-3">0%</span>
            </div>
            
            <div class="stat-item">
                <div class="bar-container">
                    <div class="bar green-bar result-bar bar-4" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-4">0%</span>
            </div>
            
        </div>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =========================================================================
            // 1. 점수 합산 로직 (P1 점수 + P2, P3, P4 답변) - 변경 없음
            // =========================================================================
            
            // Page 1에서 저장된 기본 점수 (Q1-Q8)
            const quizScoresFromPage1 = JSON.parse(localStorage.getItem('quizScores') || '{}');
            
            // Page 2, 3, 4에서 저장된 답변 (Q9-Q32)
            const quizAnswers = JSON.parse(localStorage.getItem('quizAnswers') || '{}');

            // 점수 초기화 (Page 1에서 온 점수부터 시작)
            let totalScores = {
                Yellow: quizScoresFromPage1.Yellow || 0,
                Purple: quizScoresFromPage1.Purple || 0,
                Pink: quizScoresFromPage1.Pink || 0,
                Green: quizScoresFromPage1.Green || 0
            };
            
            // 질문 ID와 항목 색상 매핑 (Q9-Q32)
            const colorMap = {
                // P2 (Q9-Q16)
                'Q9': 'Yellow', 'Q13': 'Yellow', 'Q10': 'Purple', 'Q15': 'Purple',
                'Q11': 'Pink', 'Q14': 'Pink', 'Q12': 'Green', 'Q16': 'Green',
                // P3 (Q17-Q24)
                'Q17': 'Yellow', 'Q21': 'Yellow', 'Q19': 'Purple', 'Q23': 'Purple',
                'Q18': 'Pink', 'Q22': 'Pink', 'Q20': 'Green', 'Q24': 'Green',
                // P4 (Q25-Q32)
                'Q25': 'Yellow', 'Q29': 'Yellow', 'Q27': 'Purple', 'Q31': 'Purple',
                'Q26': 'Pink', 'Q30': 'Pink', 'Q28': 'Green', 'Q32': 'Green',
            };
            
            // Page 2, Page 3, Page 4의 답변 합산
            for (const pageId in quizAnswers) {
                const answers = quizAnswers[pageId];
                for (const qId in answers) {
                    const color = colorMap[qId];
                    // answer.value는 문자열이므로 반드시 숫자로 변환합니다.
                    const score = parseInt(answers[qId].value, 10); 
                    
                    if (color && !isNaN(score)) {
                        totalScores[color] += score;
                    }
                }
            }

            // 최종 점수 변수에 할당
            const yellowScore = totalScores.Yellow;
            const purpleScore = totalScores.Purple;
            const pinkScore = totalScores.Pink;
            const greenScore = totalScores.Green;
            
            // =========================================================================
            // 2. 퍼센트 계산 (색깔 막대가 176px 기준에 맞춰 비율대로 움직이도록 % 계산) - 변경 없음
            // =========================================================================
            
            // 총 8문항 * 최대 3점 = 24점
            const MAX_SCORE_ABSOLUTE = 24; 
            const maxScore = MAX_SCORE_ABSOLUTE;

            const calculatePercentage = (score) => {
                if (maxScore === 0) return 0; 
                // 점수를 절대 최대 점수(24)로 나누어 반올림하여 %를 계산합니다.
                return Math.min(100, Math.round((score / maxScore) * 100)); 
            };

            const percentage = {
                Yellow: calculatePercentage(yellowScore),
                Purple: calculatePercentage(purpleScore),
                Pink: calculatePercentage(pinkScore),
                Green: calculatePercentage(greenScore)
            };
            
            // =========================================================================
            // 3. UI 업데이트 함수 실행 - 변경 없음
            // =========================================================================

            const updateResultUI = (barSelector, textSelector, percent) => {
                const barElement = document.querySelector(barSelector);
                const textElement = document.querySelector(textSelector);

                if (barElement) {
                    // bar-container(176px)를 기준으로 퍼센트(%) 값을 막대 너비로 설정합니다.
                    barElement.style.width = `${percent}%`;
                }
                if (textElement) {
                    textElement.textContent = `${percent}%`;
                }
            };

            updateResultUI('.result-bar.bar-1', '.percentage-text.text-1', percentage.Yellow);
            updateResultUI('.result-bar.bar-2', '.percentage-text.text-2', percentage.Purple);
            updateResultUI('.result-bar.bar-3', '.percentage-text.text-3', percentage.Pink);
            updateResultUI('.result-bar.bar-4', '.percentage-text.text-4', percentage.Green);

        });
    </script>
</body>
</html>