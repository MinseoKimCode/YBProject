<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>결과 페이지 - 막대 그래프 오버레이</title>
    <style>
        /* ------------------------------------------- */
        /* 0. 폰트 선언 */
        /* ------------------------------------------- */
        @font-face {
            font-family: 'SUIT';
            font-weight: 700; /* Bold weight */
            /* SUIT-Bold.ttf 파일로 경로 및 포맷 수정 완료 */
            src: url('Font/SUIT-Bold.ttf') format('truetype'); 
            font-display: swap;
        }

        /* ------------------------------------------- */
        /* 1. 기본 설정 및 뷰포트 고정 */
        /* ------------------------------------------- */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; 
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            box-sizing: border-box;
            background-color: #ffffff; 
            /* ⭐ 가로 스크롤(좌우 움직임)을 완전히 막는 설정 */
            overflow: hidden; 
        }

        /* ------------------------------------------- */
        /* 2. 메인 컨테이너 (모바일 뷰포트 역할) */
        /* ------------------------------------------- */
        #result-container {
            width: 100%;
            max-width: 375px; 
            height: 100%;
            position: relative; 
            background-color: #ffffff; 
            /* ⭐ 컨테이너 내에서만 세로 스크롤 허용 */
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            padding-bottom: 50px; 
        }
        
        #result-container::-webkit-scrollbar { display: none; }
        #result-container { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ------------------------------------------- */
        /* 3. 결과 이미지 및 배경 */
        /* ------------------------------------------- */
        .result-image {
            width: 100%;
            height: auto;
            display: block;
            margin-top: 0; 
        }

        /* ------------------------------------------- */
        /* 4. 통계 섹션 (막대 그래프 영역) */
        /* ------------------------------------------- */
        .stat-section {
            position: absolute;
            top: 1030px; /* 고객님 설정 값 유지 */
            left: 73.8%; /* 고객님 설정 값 유지 */
            transform: translateX(-50%);
            width: 90%; 
            max-width: 337.5px; 
            padding-top: 50px; 
        }
        
        .stat-item {
            display: flex;
            align-items: center;
        }
        
        /* ⭐⭐ 항목별 간격 조정 CSS - 고객님 설정 값 유지 ⭐⭐ */
        /* 노랑 막대 아래 간격 (그룹 1) */
        .stat-item.item-1 { margin-bottom: 71px; } 
        /* 보라 막대 아래 간격 (그룹 2) */
        .stat-item.item-2 { margin-bottom: 71px; } 
        /* 핑크 막대 아래 간격 (그룹 3) */
        .stat-item.item-3 { margin-bottom: 70px; } 
        /* 초록 막대 아래 간격 (마지막 항목) */
        .stat-item.item-4 { margin-bottom: 0px; }
        /* ⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐ */
        
        .bar-container {
            /* ⭐ 그래프 전체 길이 176px로 고정 */
            width: 176px; 
            height: 5px; /* 굵기 5px 유지 */
            background-color: #e9ecef;
            border-radius: 2.5px; /* 높이에 맞춰 2.5px 유지 */
            overflow: hidden;
            margin: 0 10px 0 0; 
            flex-shrink: 0; 
        }

        .result-bar {
            height: 100%;
            transition: width 1s ease-out;
            border-radius: 2.5px; /* 높이에 맞춰 2.5px 유지 */
        }

        /* 색상 클래스 */
        .yellow-bar { background-color: #FFC107; }
        .purple-bar { background-color: #A347FF; }
        .pink-bar { background-color: #FF66B2; }
        .green-bar { background-color: #00CD95; }
        .gray-bar { background-color: #ced4da; }

        /* ------------------------------------------- */
        /* 4.1. 퍼센트 텍스트 스타일 수정 (SUIT Bold 24px, 자간 -2px) */
        /* ------------------------------------------- */
        .score-info {
            font-family: 'SUIT', sans-serif; /* SUIT 폰트 적용 */
            font-size: 24px; /* 24px */
            font-weight: 700; /* Bold */
            letter-spacing: -2px; /* 자간 -2px */
            
            color: #161317; /* 기본 색상 (최고점일 때) */
            width: 40px; 
            text-align: right;
            flex-shrink: 0;
        }
        
        /* 비최고점 그래프의 퍼센트 텍스트 색상 (연회색) */
        .score-info.gray-text {
            color: #adb5bd; 
        }
        
        /* ------------------------------------------- */
        /* 5. 기타 요소 오버레이 */
        /* ------------------------------------------- */
        .overlay-text-1 { position: absolute; top: 110px; left: 50%; transform: translateX(-50%); font-size: 24px; font-weight: 800; color: #161317; z-index: 5; }
        
        /* ------------------------------------------- */
        /* 6. 하단 버튼 */
        /* ------------------------------------------- */
        .footer {
            width: 100%;
            max-width: 375px;
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 0;
            background-color: #FFFFFF;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
            z-index: 100;
            text-align: center;
        }
        
        .home-button {
            width: 90%;
            max-width: 337.5px;
            height: 50px; 
            background-color: #161317;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 800;
            color: #FFFFFF;
            cursor: pointer;
            line-height: 50px;
            display: inline-block;
            text-decoration: none;
        }


    </style>
</head>
<body>
    <div id="result-container">

        <img id="result-main-image" src="Image/결과1_디지털.svg" alt="디지털 과부하 결과 이미지" class="result-image">

        <div class="stat-section">
            <div class="stat-item item-1">
                <div class="bar-container">
                    <div class="bar yellow-bar result-bar bar-1" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-1">0%</span>
            </div>
            <div class="stat-item item-2">
                <div class="bar-container">
                    <div class="bar purple-bar result-bar bar-2" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-2">0%</span>
            </div>
            <div class="stat-item item-3">
                <div class="bar-container">
                    <div class="bar pink-bar result-bar bar-3" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-3">0%</span>
            </div>
            <div class="stat-item item-4">
                <div class="bar-container">
                    <div class="bar green-bar result-bar bar-4" style="width: 0%;"></div>
                </div>
                <span class="score-info percentage-text text-4">0%</span>
            </div>
        </div>
        
    </div>

    <div class="footer">
        <a href="index.html" class="home-button">다시 테스트 하기</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // =========================================================================
            // 1. 점수 계산 로직 (유지)
            // =========================================================================

            const quizAnswers = JSON.parse(localStorage.getItem('quizAnswers') || '{}');
            const maxScoreTotal = 24; 
            
            const questionMap = {
                'Q1': 'Yellow', 'Q5': 'Yellow', 'Q2': 'Purple', 'Q6': 'Purple', 'Q3': 'Pink', 'Q7': 'Pink', 'Q4': 'Green', 'Q8': 'Green',
                'Q9': 'Yellow', 'Q13': 'Yellow', 'Q10': 'Purple', 'Q15': 'Purple', 'Q11': 'Pink', 'Q14': 'Pink', 'Q12': 'Green', 'Q16': 'Green',
                'Q17': 'Yellow', 'Q21': 'Yellow', 'Q19': 'Purple', 'Q23': 'Purple', 'Q18': 'Pink', 'Q22': 'Pink', 'Q20': 'Green', 'Q24': 'Green',
                'Q25': 'Yellow', 'Q29': 'Yellow', 'Q27': 'Purple', 'Q31': 'Purple', 'Q26': 'Pink', 'Q30': 'Pink', 'Q28': 'Green', 'Q32': 'Green', 
            };
            
            let yellowScore = 0, purpleScore = 0, pinkScore = 0, greenScore = 0;
            
            for (const pageId in quizAnswers) {
                const answers = quizAnswers[pageId];
                for (const qId in answers) {
                    const score = parseInt(answers[qId].value, 10);
                    const category = questionMap[qId];

                    if (category === 'Yellow') yellowScore += score;
                    else if (category === 'Purple') purpleScore += score;
                    else if (category === 'Pink') pinkScore += score;
                    else if (category === 'Green') greenScore += score;
                }
            }

            const calculatePercentage = (score) => Math.round((score / maxScoreTotal) * 100);

            const percentage = {
                Yellow: calculatePercentage(yellowScore),
                Purple: calculatePercentage(purpleScore),
                Pink: calculatePercentage(pinkScore),
                Green: calculatePercentage(greenScore)
            };
            
            const maxPercentage = Math.max(percentage.Yellow, percentage.Purple, percentage.Pink, percentage.Green);


            // =========================================================================
            // 2. 결과 이미지 설정 함수 (15가지 경우의 수 매핑 로직 유지)
            // =========================================================================
            function displayResultImage(percentages, maxScore) {
                const resultImage = document.getElementById('result-main-image');
                if (!resultImage) return;

                const Y = percentages.Yellow;
                const P = percentages.Purple;
                const I = percentages.Pink; 
                const G = percentages.Green; 

                const maxScoreValue = Math.max(Y, P, I, G);

                let key = '';
                if (Y === maxScoreValue) key += 'Y';
                if (P === maxScoreValue) key += 'P';
                if (I === maxScoreValue) key += 'I'; 
                if (G === maxScoreValue) key += 'G';
                
                const imageMap = {
                    'Y': '결과1_디지털.svg', 'P': '결과2_수면.svg', 'I': '결과3_가성.svg', 'G': '결과4_알콜.svg', 
                    'YP': '결과5_디지털,수면.svg', 'YI': '결과6_디지털,가성.svg', 'YG': '결과7_디지털,알콜.svg', 
                    'PI': '결과8_수면,가성.svg', 'PG': '결과9_수면,알콜.svg', 'IG': '결과10_가성,알콜.svg', 
                    'YPI': '결과11_디지털,수면,가성.svg', 'YPG': '결과12_디지털,수면,알콜.svg', 
                    'YIG': '결과13_디지털,가성,알콜.svg', 'PIG': '결과14_수면,가성,알콜.svg', 
                    'YPIG': '결과15_디지털,수면,가성,알콜.svg', 
                };

                const fileName = imageMap[key];
                
                if (fileName) {
                    resultImage.src = `Image/${fileName}`;
                    resultImage.alt = `${key} 결과 이미지`; 
                } else {
                    resultImage.src = `Image/${imageMap['Y']}`;
                    resultImage.alt = '기본 디지털 과부하 결과 이미지';
                }
            }

            displayResultImage(percentage, maxPercentage);

            
            // =========================================================================
            // 3. UI 업데이트 함수 실행 (막대 그래프 색상 및 텍스트 색상 동적 변경)
            // =========================================================================

            const categoryInfo = [
                { key: 'Yellow', barSelector: '.result-bar.bar-1', colorClass: 'yellow-bar' },
                { key: 'Purple', barSelector: '.result-bar.bar-2', colorClass: 'purple-bar' },
                { key: 'Pink', barSelector: '.result-bar.bar-3', colorClass: 'pink-bar' },
                { key: 'Green', barSelector: '.result-bar.bar-4', colorClass: 'green-bar' }
            ];
            
            const GRAY_CLASS = 'gray-bar';
            const ALL_COLOR_CLASSES = categoryInfo.map(c => c.colorClass).join(' ') + ' ' + GRAY_CLASS;

            categoryInfo.forEach((info, index) => {
                const percent = percentage[info.key];
                const isWinner = percent === maxPercentage;

                const barElement = document.querySelector(info.barSelector);
                const textElement = document.querySelector(`.percentage-text.text-${index + 1}`);

                if (barElement) {
                    // 막대 색상 변경 (최고점만 원래 색상, 나머지는 회색)
                    barElement.classList.remove(...ALL_COLOR_CLASSES.split(' ')); 

                    if (isWinner) {
                        barElement.classList.add(info.colorClass);
                    } else {
                        barElement.classList.add(GRAY_CLASS);
                    }
                    
                    barElement.style.width = `${percent}%`;
                }

                if (textElement) {
                    // 텍스트 표시
                    textElement.textContent = `${percent}%`;
                    
                    // 텍스트 색상 변경 (최고점만 기본 색상, 나머지는 연회색)
                    if (isWinner) {
                        textElement.classList.remove('gray-text'); 
                    } else {
                        textElement.classList.add('gray-text'); 
                    }
                }
            });

        });
    </script>
</body>
</html>